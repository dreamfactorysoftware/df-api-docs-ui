"use strict";angular.module("dfUtility",[]).constant("MOD_UTILITY_ASSET_PATH","admin_components/adf-utility/").directive("dfSectionHeader",[function(){return{restrict:"E",scope:{title:"=?"},template:'<div class="df-section-header df-section-all-round"><h4>{{title}}</h4></div>',link:function(scope,elem,attrs){}}}]).directive("dfSectionToolbar",["MOD_UTILITY_ASSET_PATH","$compile","$location","$timeout","$route",function(MOD_UTILITY_ASSET_PATH,$compile,$location,$timeout,$route){return{restrict:"E",scope:!1,transclude:!0,templateUrl:MOD_UTILITY_ASSET_PATH+"views/df-toolbar.html",link:function(scope,elem,attrs){}}}]).directive("dreamfactoryAutoHeight",["$window","$route",function($window){return{restrict:"A",link:function(scope,elem,attrs){scope._getWindow=function(){return $(window)},scope._getDocument=function(){return $(document)},scope._getParent=function(parentStr){switch(parentStr){case"window":return scope._getWindow();case"document":return scope._getDocument();default:return $(parentStr)}},scope._setElementHeight=function(){angular.element(elem).css({height:scope._getParent(attrs.autoHeightParent).height()-200-attrs.autoHeightPadding})},scope._setElementHeight(),angular.element($window).on("resize",function(){scope._setElementHeight()})}}}]).directive("resize",[function($window){return function(scope,element){var w=angular.element($window);scope.getWindowDimensions=function(){return{h:w.height(),w:w.width()}},scope.$watch(scope.getWindowDimensions,function(newValue,oldValue){scope.windowHeight=newValue.h,scope.windowWidth=newValue.w,angular.element(element).css({width:newValue.w-angular.element("sidebar").css("width")+"px"})},!0)}}]).directive("dfFsHeight",["$window","$rootScope",function($window,$rootScope){return function(scope,elem,attrs){var setSize=function(){var _elem=$(elem),winHeight=$(window).height(),winWidth=$(window).width();_elem.is("#swagger")?_elem.attr("height",winHeight-25+"px"):winWidth>=992?$(elem).css({height:winHeight-120}):$(elem).css({height:"auto"})};scope.$on("apidocs:loaded",function(e){setSize()}),$rootScope.$on("$routeChangeSuccess",function(e){setSize()}),$(document).ready(function(){setSize()}),$(window).on("resize",function(){setSize()})}}]).filter("orderAndShowSchema",[function(){return function(items,fields,reverse){var filtered=[];return angular.forEach(fields,function(field){angular.forEach(items,function(item){item.name===field.name&&1==field.active&&filtered.push(item)})}),reverse&&filtered.reverse(),filtered}}]).filter("orderAndShowValue",[function(){return function(items,fields,reverse){var filtered=[];return angular.forEach(fields,function(field){for(var _key in items)_key===field.name&&1==field.active&&filtered.push(items[_key])}),reverse&&filtered.reverse(),filtered}}]).filter("orderObjectBy",[function(){return function(items,field,reverse){function cmp(a,b){return a==b?0:b>a?-1:1}var filtered=[];if(angular.forEach(items,function(item){filtered.push(item)}),0===filtered.length)return filtered;var filterOnThis=filtered[0].record?filtered[0].record[field]:filtered[0][field];switch(typeof filterOnThis){case"number":filtered.sort(function(a,b){return a.hasOwnProperty("record")&&b.hasOwnProperty("record")?(a=a.record[field],b=b.record[field]):(a=a[field],b=b[field]),a=null===a||void 0===a?0:a,b=null===b||void 0===b?0:b,cmp(Number(a),Number(b))});break;case"string":filtered.sort(function(a,b){a.hasOwnProperty("record")&&b.hasOwnProperty("record")?(a=a.record[field],b=b.record[field]):(a=a[field],b=b[field]),a=null===a||void 0===a?"":a,b=null===b||void 0===b?"":b;var upA=a.toUpperCase(),upB=b.toUpperCase();return upB>upA?-1:upA>upB?1:0});break;default:filtered.sort(function(a,b){a.hasOwnProperty("record")&&b.hasOwnProperty("record")?(a=a.record[field],b=b.record[field]):(a=a[field],b=b[field]),a=null===a||void 0===a?"":a,b=null===b||void 0===b?"":b;var upA=a,upB=b;return upB>upA?-1:upA>upB?1:0})}return reverse&&filtered.reverse(),filtered}}]).service("dfApiDataService",["$q","$http","$location","$cookies",function($q,$http,$location,$cookies){function loadOne(api){var deferred=$q.defer(),url=$location.protocol()+"://"+$location.host();return $location.port()&&(url+=":"+$location.port()),url+="/api/v2/"+api.path,$http.get(url).then(function(result){deferred.resolve(result.data)},function(error){deferred.reject(error.data)}),deferred.promise}return{getApiData:function(apis){var deferred=$q.defer(),promises=apis.map(function(api){return loadOne(api)});return $q.all(promises).then(function(response){deferred.resolve(response)},function(response){deferred.reject(response)}),deferred.promise},getQueryParameter:function(key){key=key.replace(/[*+?^$.\[\]{}()|\\\/]/g,"\\$&");var match=window.location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)")),result=match&&decodeURIComponent(match[1].replace(/\+/g," "));return result?result:""}}}]).run(["$cookies","$http",function($cookies,$http){var getSessionTokenCookie=function(){var phpSessionId=window.parent.document.cookie.match(/PHPSESSID=[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\;/i);if(null==phpSessionId)return"";if("undefined"==typeof phpSessionId)return"";if(phpSessionId.length<=0)return"";phpSessionId=phpSessionId[0];var end=phpSessionId.lastIndexOf(";");return-1==end&&(end=phpSessionId.length),phpSessionId.substring(10,end)},sessionToken=getSessionTokenCookie();$cookies.put("PHPSESSID",sessionToken),$http.defaults.headers.common["X-DreamFactory-Session-Token"]=sessionToken}]).directive("dfEmptySearchResult",["MOD_UTILITY_ASSET_PATH","$location",function(MOD_UTILITY_ASSET_PATH,$location){return{restrict:"E",scope:!1,templateUrl:MOD_UTILITY_ASSET_PATH+"views/df-empty-search-result.html",link:function(scope,elem,attrs){$location.search()&&$location.search().filter&&(scope.$parent.filterText=$location.search()&&$location.search().filter?$location.search().filter:null)}}}]).service("dfNotify",[function(){function pnotify(messageOptions){!function(){PNotify.removeAll(),PNotify.prototype.options.styling="fontawesome",new PNotify({title:messageOptions.module,type:messageOptions.type,text:messageOptions.message,addclass:"stack_topleft",animation:"fade",animate_speed:150,position_animate_speed:150,stack:stack_topleft,mouse_reset:!1})}()}function parseDreamfactoryError(errorDataObj){var result,error,resource,message;return"[object String]"===Object.prototype.toString.call(errorDataObj)?result=errorDataObj:(result="The server returned an unknown error.",errorDataObj.data&&(error=errorDataObj.data.error,error&&(message=error.message,message&&(result=message),1e3===error.code&&error.context&&(resource=error.context.resource,error=error.context.error,resource&&error&&(result="",angular.forEach(error,function(index){result&&(result+="\n"),result+=resource[index].message})))))),result}var stack_topleft={dir1:"down",dir2:"right",push:"top",firstpos1:25,firstpos2:25,spacing1:5,spacing2:5};return{success:function(options){pnotify(options)},error:function(options){options.message=parseDreamfactoryError(options.message),pnotify(options)},warn:function(options){pnotify(options)},confirmNoSave:function(){return confirm("Continue without saving?")},confirm:function(msg){return confirm(msg)}}}]),angular.module("dfTable",["dfUtility"]).constant("DF_TABLE_ASSET_PATH","admin_components/adf-table/").run(["$templateCache",function($templateCache){$templateCache.put("df-input-text.html",'<input type="{{templateData.type}}"  class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),$templateCache.put("df-input-ref-text.html",'<input type="{{templateData.type}}"  class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),$templateCache.put("df-input-number.html",'<input type="{{templateData.type}}" step="any" class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),$templateCache.put("df-input-int.html",'<input type="{{templateData.type}}" step="1" class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),$templateCache.put("df-input-textarea.html",'<textarea class="form-control" rows="3" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required"></textarea>'),$templateCache.put("df-input-binary.html","<p>BINARY DATA</p>"),$templateCache.put("df-input-datetime.html","<p>DATETIME</p>"),$templateCache.put("df-input-reference.html",'<div class="well"><df-table data-options="relatedOptions" data-parent-record="currentEditRecord" data-export-field="field"></df-table></div>'),$templateCache.put("df-input-checkbox.html",'<label><input type="checkbox" data-ng-model="currentEditRecord[field.name]" data-ng-checked="currentEditRecord[field.name]" data-ng-required="field.required"></label>'),$templateCache.put("df-input-bool-picklist.html",'<div class="form-group"><select class="form-control" data-ng-model="currentEditRecord[field.name]" data-ng-options="bool.value as bool.name for bool in __dfBools" data-ng-required="field.required"></select></div>'),$templateCache.put("df-input-select.html",'<select class="form-control" data-ng-model="currentEditRecord[field.name]" data-ng-options="obj[overrideFields[templateData.prop].display.value] as obj[overrideFields[templateData.prop].display.label] for obj in overrideFields[templateData.prop].records" data-ng-required="field.required" data-ng-disabled="currentEditRecord[templateData.dependent]"><option value="">-- None --</option></select>'),$templateCache.put("df-input-values-picklist.html",'<div class="row"><div class="col-xs-12 col-md-6"><div class="input-group"><input type="text" class="form-control" data-ng-model="currentEditRecord[field.name]" placeholder="Enter Value or Choose from list" data-ng-required="field.required"><div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu pull-right df-dropdown-height"><li data-ng-click="assignValue(item)" data-ng-repeat="item in data"><a>{{item}}</a></li></ul></div><!-- /btn-group --></div><!-- /input-group --></div><!-- /.col-lg-6 --></div>'),$templateCache.put("df-input-values-only-picklist.html",'<div class="form-group"><select class="form-control" data-ng-model="currentEditRecord[field.name]" data-ng-options="item for item in data" data-ng-required="field.required"></select></div>'),$templateCache.put("df-input-date-time-picker.html",'<div class="form-group col-xs-12">\n <div class="input-group col-sm-6 col-md-4">\n<span class="input-group-btn">\n<button type="button" data-ng-disabled="!templateData.editable" class="btn btn-default btn-small" data-ng-click="open($event)"><i class="fa fa-calendar fa-fw"></i></button><button type="button" class="btn btn-default" data-ng-disabled="!templateData.editable" data-ng-click="setNow()">Now</button>\n</span>\n<input type="text" class="form-control" data-ng-disabled="!templateData.editable" data-datepicker-popup="{{format}}" data-ng-model="dt" data-is-open="opened"  data-date-disabled="disabled(date, mode)" data-ng-required="field.required" data-close-text="Close" /></div>\n<div class="col-sm-6 col-md-2">\n<timepicker style="display: inline-block" data-ng-model="mytime" data-ng-change="changed()" show-meridian="ismeridian"></timepicker>\n</div>\n</div>')}]).filter("typeFilter",[function(){return function(object){var array=[];return angular.forEach(object,function(option){("boolean"==option.type||"integer"==option.type||"string"==option.type||"text"==option.type||"float"==option.type||"double"==option.type||"decimal"==option.type)&&array.push(option)}),array}}]).directive("dfTable",["DF_TABLE_ASSET_PATH","$http","$q","$filter","$compile","dfObjectService","dfTableEventService","dfTableCallbacksService",function(DF_TABLE_ASSET_PATH,$http,$q,$filter,$compile,dfObjectService,dfTableEventService,dfTableCallbacksService){return{restrict:"E",scope:{userOptions:"=options",parentRecord:"=?",exportField:"=?"},templateUrl:DF_TABLE_ASSET_PATH+"views/dreamfactory-table.html",link:function(scope,elem,attrs){scope.es=dfTableEventService,scope.defaults={service:"",table:"",url:"",normalizeData:!1,normalizeSchema:!0,autoClose:!0,params:{filter:null,limit:50,offset:0,fields:"*",include_schema:!0,include_count:!0},defaultFields:null,overrideFields:[],extendFieldTypes:[],extendData:[],extendSchema:[],relatedData:[],excludeFields:[],groupFields:[],exportValueOn:!1,allowChildTable:!1,childTableAttachPoint:null,isChildTable:!1},scope.options={},scope.disableTableBtns=!1,scope.record=null,scope.schema=null,scope.overrideFields={},scope.tableFields={onStartTotalActiveFields:0},scope.tableFieldsAll=!1,scope.tableFilterOn=!0,scope.defaultFieldsShown={},scope.numAutoSelectFields=8,scope.selectedAll=!1,scope.filterOn=!1,scope.filter={viewBy:"",prop:"",props:"",type:"",value:null},scope.operators={integer:["<",">","="],"boolean":[],string:[],text:[],"float":["<",">","="],"double":["<",">","="],decimal:["<",">","="]},scope.filterType={operator:null},scope.order={orderBy:"",orderByReverse:!1},scope.filteredRecords=!1,scope.orderedRecords=!1,scope.activeTab=null,scope.activeView="table",scope.pagesArr=[],scope.currentPage={},scope.currentEditRecord=null,scope.extendFieldTypes={},scope.inProgress=!1,scope.count=0,scope._exportValue=null,scope.newRecord=null,scope.relatedExpand=!1,scope.extendedData={},scope.extendedSchema={},scope.excludedFields={},scope.filteredSchema=[],scope.groupedSchema=[],scope.childTableActive=!1,scope.childTableOptions={},scope.childTableParentRecord=null,scope.setTab=function(tabStr){scope._setTab(tabStr)},scope.toggleSelected=function(dataObj){return scope.childTableActive?!1:void scope._toggleSelected(dataObj)},scope.getPrevious=function(){return scope._isFirstPage()||scope._isInProgress()?!1:void(scope._checkForUnsavedRecords(scope.record)?scope._confirmAction("You have Unsaved records.  Continue without saving?",scope._getPrevious):scope._getPrevious())},scope.getNext=function(){return scope._isLastPage()||scope._isInProgress()?!1:void(scope._checkForUnsavedRecords(scope.record)?scope._confirmAction("You have Unsaved records.  Continue without saving?",scope._getNext):scope._getNext())},scope.editRecord=function(dataObj){scope._editRecord(dataObj)},scope.createRecord=function(){scope._createRecord()},scope.saveRecords=function(){scope._saveRecords()},scope.revertRecords=function(){scope._revertRecords()},scope.deleteRecords=function(){scope._confirmAction("You are about to delete records. Continue?",scope._deleteRecords)},scope.applyFilter=function(){scope._applyFilter()},scope.removeFilter=function(){scope._removeFilter()},scope.refreshResults=function(){scope._refreshResults()},scope.orderOnSelect=function(fieldObj){scope._orderOnSelect(fieldObj)},scope.setExportValue=function(dataObj){scope._setExportValue(dataObj)},scope.toggleExpandEditor=function(){scope._toggleExpandEditor()},scope.editExportRecord=function(dataObj){scope._editExportRecord(dataObj)},scope.filterRecords=function(){scope._filterRecords()},scope.toggleAllFields=function(){scope._toggleAllFields()},scope.resetAllFields=function(){scope._resetAllFields()},scope.toggleAllRecords=function(){scope._toggleAllRecords()},scope.showChildTable=function(parentRecordObj){scope._showChildTable(parentRecordObj)},scope._addSelectedProp=function(dataObj){dataObj.__dfUI.hasOwnProperty("selected")||(dataObj.__dfUI.selected=!1)},scope._addUnsavedProp=function(dataObj){dataObj.__dfUI.hasOwnProperty("unsaved")||(dataObj.__dfUI.unsaved=!1)},scope._addExportProp=function(dataObj){dataObj.__dfUI.hasOwnProperty("export")||(dataObj.__dfUI["export"]=!1)},scope._addHideProp=function(dataObj){dataObj.__dfUI.hasOwnProperty("hide")||(dataObj.__dfUI.hide=!1)},scope._addStateProps=function(dataObj){dataObj.hasOwnProperty.__dfUI||(dataObj.__dfUI={}),scope._addSelectedProp(dataObj),scope._addUnsavedProp(dataObj),scope._addExportProp(dataObj),scope._addHideProp(dataObj)},scope._removeStateProps=function(dataObj){dataObj.hasOwnProperty.__dfUI&&delete dataObj.__dfUI},scope._toggleSelectedState=function(dataObj){dataObj.__dfUI.selected=!dataObj.__dfUI.selected},scope._toggleUnsavedState=function(dataObj){dataObj.__dfUI.unsaved=!dataObj.__dfUI.unsaved},scope._setSelectedState=function(dataObj,stateBool){dataObj.__dfUI.selected=stateBool},scope._setUnsavedState=function(dataObj,stateBool){dataObj.__dfUI.unsaved=stateBool},scope._setExportState=function(dataObj,stateBool){dataObj&&(dataObj.__dfUI["export"]=stateBool)},scope._setHideState=function(dataObj,stateBool){dataObj&&(dataObj.__dfUI.hide=stateBool)},scope._isUnsaved=function(dataObj){return dataObj.__dfUI.unsaved},scope._isSelected=function(dataObj){return dataObj.__dfUI.selected},scope._isExport=function(dataObj){return dataObj.__dfUI["export"]},scope._checkForUnsavedRecords=function(data){if(!data)return!1;var unsavedRecords=!1,i=0;do{if(i>=data.length)break;data[i].__dfUI.unsaved&&(unsavedRecords=!0),i++}while(0==unsavedRecords);return unsavedRecords},scope._checkForParams=function(){var params={};return params=scope.options.hasOwnProperty("params")?scope.options.params:scope.defaults.params},scope._getRecordsFromServer=function(requestDataObj){var params=scope._checkForParams();return requestDataObj=requestDataObj||null,requestDataObj&&(params=dfObjectService.mergeObjects(requestDataObj.params,params)),scope.options.relatedData.length>0&&(params.related=scope.options.relatedData.join(",")),$http({method:"GET",url:scope.options.url,params:params})},scope._getRecordsFromData=function(dataObj){var limit=scope._checkForParams().limit,records=[];return dataObj.hasOwnProperty("resource")?records=dataObj.resource:dataObj.hasOwnProperty("data")&&(records=dataObj.data.hasOwnProperty("resource")?dataObj.data.resource:dataObj.data.data.resource),records.length>limit?records.slice(0,limit):records},scope._getMetaFromData=function(dataObj){var meta={};return dataObj.hasOwnProperty("meta")?meta=dataObj.meta:dataObj.hasOwnProperty("data")&&(meta=dataObj.data.hasOwnProperty("meta")?dataObj.data.meta:dataObj.data.data.meta),meta},scope._getSchemaFromData=function(dataObj){return scope._getMetaFromData(dataObj).schema},scope._getCountFromMeta=function(dataObj){var count=scope._getMetaFromData(dataObj).count;return scope._setCount(count),count},scope._setCount=function(countInt){scope.count=countInt},scope._getOptionFromParams=function(keyStr){return scope._checkForParams()[keyStr]},scope._setOptionFromParams=function(keyStr,valueStr){},scope._buildField=function(fieldNameStr){console.log(fieldNameStr)},scope._createRevertCopy=function(dataObj){dataObj.__dfData={},dataObj.__dfData.revert=angular.copy(dataObj),dataObj.__dfData.revert.hasOwnProperty("_exportValue")||(dataObj.__dfData.revert._exportValue={})},scope._getRevertCopy=function(dataObj){return dataObj.__dfData.revert},scope._hasRevertCopy=function(dataObj){return dataObj.hasOwnProperty("__dfData")&&dataObj.__dfData.hasOwnProperty("revert")?!0:!1},scope._removeRevertCopy=function(dataObj){dataObj.__dfData.revert&&delete dataObj.__dfData.revert},scope._removeAllDFData=function(dataObj){dataObj.__dfData&&delete dataObj.__dfData},scope._removeAllUIData=function(dataObj){delete dataObj.__dfUI},scope._compareObjects=function(dataObj1,dataObj2){for(var key in dataObj1)if("dfUISelected"!==key&&"dfUIUnsaved"!==key&&"__dfUI"!==key&&"__dfData"!=key&&"created_date"!=key&&"last_modified_date"!=key&&"$$hashKey"!==key&&dataObj1[key]!==dataObj2[key])return null!=dataObj1[key]&&""!=dataObj1[key]||null!=dataObj2[key]&&""!=dataObj2[key]?dataObj1[key]instanceof Array&&dataObj2[key]instanceof Array&&dataObj1[key].length==dataObj2[key].length?!1:!0:!1;return!1},scope._getRecordsWithState=function(recordsDataArr,stateStr,removeDFDataBool,removeUIDataBool){var records=[];return removeDFDataBool="undefined"!=typeof removeDFDataBool?removeDFDataBool:!1,removeUIDataBool="undefined"!=typeof removeUIDataBool?removeUIDataBool:!1,angular.forEach(recordsDataArr,function(_obj){_obj.__dfUI[stateStr]&&(removeDFDataBool&&scope._removeAllDFData(_obj),removeUIDataBool&&scope._removeAllUIData(_obj),records.push(_obj))}),records},scope._saveRecordsToServer=function(recordsDataArr){if(0==recordsDataArr.length){var defer=$q.defer(),error="No records selected for save.";return defer.reject(error),defer.promise}return $http({method:"PATCH",url:scope.options.url,data:{resource:recordsDataArr}})},scope._deleteRecordsFromServer=function(recordsDataArr){if(0==recordsDataArr.length){var defer=$q.defer(),error="No records selected for delete.";return defer.reject(error),defer.promise}return $http({method:"DELETE",url:scope.options.url,data:{resource:recordsDataArr}})},scope._isInProgress=function(){return scope.inProgress},scope._setInProgress=function(stateBool){scope.inProgress=stateBool},scope._createNewRecordObj=function(){var newRecord={};return angular.forEach(scope.schema.field,function(_obj){scope.excludedFields.hasOwnProperty(_obj.name)&&scope.excludedFields[_obj.name].fields.create||(newRecord[_obj.name]=_obj["default"])}),scope._addStateProps(newRecord),newRecord},scope._setCurrentEditRecord=function(dataObj){scope.currentEditRecord=dataObj},scope._setNewRecordObj=function(){scope.newRecord=scope._createNewRecordObj()},scope._confirmAction=function(_message,_action){confirm(_message)&&_action.call()},scope._filterFormSchema=function(formNameStr){return 0==scope.excludedFields.length?!1:void angular.forEach(scope.schema.field,function(_obj){scope.excludedFields.hasOwnProperty(_obj.name)&&scope.excludedFields[_obj.name].fields[formNameStr]||scope.filteredSchema.push(_obj)})},scope._buildSchemaGroups=function(){if(0==scope.options.groupFields.length)return!1;var _schema=scope.filteredSchema.length>0?scope.filteredSchema:scope.schema.field;angular.forEach(scope.options.groupFields,function(fobj){var group={};group.name=fobj.name,group.fields=[],group.dividers=fobj.dividers,angular.forEach(_schema,function(item){angular.forEach(fobj.fields,function(field,index){item.name===field&&(group.fields[index]=item)})}),scope.groupedSchema.push(group)})},scope._checkForGroupedSchema=function(groupNameStr){0==scope.groupedSchema.length&&scope.groupedSchema.push({name:groupNameStr,fields:scope.schema.field})},scope._clearFilteredSchema=function(){scope.filteredSchema=[]},scope._clearGroupedSchema=function(){scope.groupedSchema=[]},scope._getDefaultFields=function(dataObj){return dataObj.hasOwnProperty("defaultFields")?dataObj.defaultFields:null},scope._removePrivateFields=function(dataObj){dataObj&&angular.forEach(scope.record,function(_obj){for(var _key in _obj)dataObj[_key]&&"private"==dataObj[_key]&&delete _obj[_key]})},scope._setElementActive=function(tabStr){scope.activeTab=tabStr},scope._setDisableTableBtnsState=function(stateBool){scope.disableTableBtns=stateBool},scope._createFieldsObj=function(schemaDataObj){if(scope.tableFields={onStartTotalActiveFields:0},!scope.defaultFieldsShown){var allKeys=Object.keys(schemaDataObj);return allKeys.length<scope.numAutoSelectFields&&(scope.numAutoSelectFields=allKeys.length),angular.forEach(schemaDataObj,function(value,index){if(scope.tableFields.onStartTotalActiveFields<scope.numAutoSelectFields&&index!=allKeys.length)switch(value.name){case"name":case"title":case"fname":case"lname":case"f_name":case"l_name":case"firstname":case"lastname":case"first_name":case"last_name":case"email":case"phone":scope.tableFields[value.name]=value,scope.tableFields[value.name].active=!0,scope.tableFields.onStartTotalActiveFields++;break;default:scope.tableFields[value.name]=value,scope.tableFields[value.name].active=!1}}),scope.tableFields.onStartTotalActiveFields<scope.numAutoSelectFields&&angular.forEach(scope.tableFields,function(_obj){if(scope.tableFields.onStartTotalActiveFields==scope.numAutoSelectFields)return!1;if(0==_obj.active)switch(_obj.type){case"date":case"time":case"datetime":_obj.active=!0,scope.tableFields.onStartTotalActiveFields++}}),scope.tableFields.onStartTotalActiveFields<scope.numAutoSelectFields&&angular.forEach(scope.tableFields,function(_obj){return scope.tableFields.onStartTotalActiveFields==scope.numAutoSelectFields?!1:void(0==_obj.active&&(_obj.active=!0,scope.tableFields.onStartTotalActiveFields++))}),!1}angular.forEach(schemaDataObj,function(value,index){if(scope.defaultFieldsShown.hasOwnProperty(value.name))switch(scope.defaultFieldsShown[value.name]){case!0:scope.tableFields[value.name]=value,scope.tableFields[value.name].active=!0;break;case!1:scope.tableFields[value.name]=value,scope.tableFields[value.name].active=!1;break;case"private":break;default:scope.tableFields[value.name]=value,scope.tableFields[value.name].active=!1}else scope.tableFields[value.name]=value,scope.tableFields[value.name].active=!1}),scope.tableFieldsAll=!1},scope._init=function(data){scope._prepareExtendedData(scope.options),scope._prepareExtendedSchema(scope.options),scope._prepareExcludedFields(scope.options),scope._prepareRecords(data)&&scope._prepareOverrideFields(scope.options),scope._prepareSchema(data),scope._prepareExtendedFieldTypes(scope.options),scope.defaultFieldsShown=scope._getDefaultFields(scope.options),scope._createFieldsObj(scope.schema.field),scope.activeTab=scope.schema.name+"-table",scope._calcPagination(data),scope.pagesArr[0].stopPropagation=!0,scope._setCurrentPage(scope.pagesArr[0])},scope._prepareRecords=function(data){return scope.record=scope._getRecordsFromData(data),scope.record?(scope._removePrivateFields(scope._getDefaultFields(scope.options)),angular.forEach(scope.record,function(_obj){scope._addStateProps(_obj),scope._addExtendedData(_obj),scope.options.exportValueOn&&scope._exportValue&&scope._checkExportValue(_obj)&&(scope._setExportState(_obj,!0),scope._exportValue=_obj)}),scope.options.normalizeData&&(scope.record=scope._normalizeData(scope.record)),!0):(scope.record=null,!1)},scope._checkExportValue=function(dataObj){return dataObj[scope.exportField.ref_field]===scope._exportValue[scope.exportField.ref_field]},scope._prepareSchema=function(data){scope.schema=scope._getSchemaFromData(data),scope.options.normalizeSchema&&scope.record.length>0&&(scope.schema=scope._normalizeSchema(scope.schema,scope.record)),angular.forEach(scope.extendedSchema,function(_obj){scope.schema.field.push(_obj)})},scope._prepareExtendedSchema=function(data){return null==data.extendSchema?!1:void angular.forEach(data.extendSchema,function(_obj){scope.extendedSchema[_obj.name]={},scope.extendedSchema[_obj.name].name=_obj.name,scope.extendedSchema[_obj.name].type=_obj.type,scope.extendedSchema[_obj.name].label=_obj.label})},scope._prepareOverrideFields=function(data){return null==data.overrideFields?!1:void angular.forEach(data.overrideFields,function(_obj){scope.overrideFields[_obj.field]={},_obj.hasOwnProperty("record")&&(scope.overrideFields[_obj.field].records=scope._getRecordsFromData(_obj.record)),scope.overrideFields[_obj.field].display=_obj.display})},scope._prepareExtendedFieldTypes=function(data){return null==data.extendFieldTypes?!1:void angular.forEach(data.extendFieldTypes,function(_obj){scope.extendFieldTypes[_obj.db_type]={};for(var _key in _obj)scope.extendFieldTypes[_obj.db_type][_key]=_obj[_key]})},scope._prepareExtendedData=function(data){return null==data.extendData?!1:void angular.forEach(data.extendData,function(_obj){scope.extendedData[_obj.name]={},scope.extendedData[_obj.name].name=_obj.name,scope.extendedData[_obj.name].value=_obj.value||null})},scope._addExtendedData=function(dataObj){angular.forEach(scope.extendedData,function(_obj){dataObj[_obj.name]=_obj.value})},scope._setActiveView=function(viewStr){scope.activeView=viewStr},scope._setExportValueToParent=function(dataObj){scope._exportValue=dataObj||null},scope._prepareExcludedFields=function(data){return null==data.extendSchema?!1:void angular.forEach(data.excludeFields,function(_obj){scope.excludedFields[_obj.name]={},scope.excludedFields[_obj.name].fields=_obj.fields})},scope._calcTotalPages=function(totalCount,numPerPage){return Math.ceil(totalCount/numPerPage)},scope._createPageObj=function(_pageNum){return{number:_pageNum+1,value:_pageNum,offset:_pageNum*scope._getOptionFromParams("limit"),stopPropagation:!1}},scope._createPagesArr=function(_totalCount){scope.pagesArr=[];for(var i=0;_totalCount>i;i++)scope.pagesArr.push(scope._createPageObj(i))},scope._setCurrentPage=function(pageDataObj){scope.currentPage=pageDataObj},scope._getCurrentPage=function(){return!scope.currentPage&&scope.pagesArr.length>0?scope.currentPage=scope.pagesArr[0]:scope.currentPage||scope.pagesArr.length||(scope.pagesArr.push(scope._createPageObj(0)),scope.currentPage=scope.pagesArr[0]),scope.currentPage},scope._isFirstPage=function(){return 0===scope._getCurrentPage().value},scope._isLastPage=function(){return scope.currentPage.value===scope.pagesArr.length-1},scope._previousPage=function(){scope.currentPage=scope.pagesArr[scope.currentPage.value-1]},scope._nextPage=function(){scope.currentPage=scope.pagesArr[scope.currentPage.value+1]},scope._calcPagination=function(newValue){scope.pagesArr=[];var count=scope._getCountFromMeta(newValue);return 0==count?(scope.pagesArr.push(scope._createPageObj(0)),!1):void scope._createPagesArr(scope._calcTotalPages(count,scope._getOptionFromParams("limit")))},scope._resetFilter=function(schemaDataObj){return schemaDataObj?void(scope.filter={viewBy:schemaDataObj.field[0].name||"",prop:schemaDataObj.field[0].name||"",type:schemaDataObj.field[0].type||"",props:schemaDataObj.field[0],value:null}):!1},scope._isFiltered=function(){return scope.filteredRecords},scope._createFilterParams=function(){var param="";switch(scope.filter.prop.type){case"boolean":param=scope.filter.prop.name+" = "+scope.filter.value;break;case"text":param=scope.filter.prop.name+' like "%'+scope.filter.value+'%"';break;case"string":param=scope.filter.prop.name+' like "%'+scope.filter.value+'%"';break;case"integer":param=scope.filter.prop.name+" "+scope.filterType.operator+" "+scope.filter.value;break;case"float":param=scope.filter.prop.name+" "+scope.filterType.operator+" "+scope.filter.value;break;case"double":param=scope.filter.prop.name+" "+scope.filterType.operator+" "+scope.filter.value;break;case"decimal":param=scope.filter.prop.name+" "+scope.filterType.operator+" "+scope.filter.value}return param},scope._unsetFilterInOptions=function(){scope.options.params.hasOwnProperty("filter")&&delete scope.options.params.filter},scope._setFilterInOptions=function(){return scope._checkForFilterValue()?scope.options.params.hasOwnProperty("filter")?(scope.options.params.filter=scope._createFilterParams(),!0):(scope.options.params.filter=scope._createFilterParams(),!0):!1},scope._checkForFilterValue=function(){return!!scope.filter.value},scope._resetOrder=function(schemaDataObj){return schemaDataObj?void(scope.order={orderBy:schemaDataObj.field[0].name||"",orderByReverse:!1}):!1},scope._isOrdered=function(){return scope.orderedRecords},scope._createOrderParams=function(){var orderStr=scope.order.orderBy+" ";return orderStr+=scope.order.orderByReverse?"DESC":"ASC"},scope._unsetOrderInOptions=function(){scope.options.params.hasOwnProperty("order")&&delete scope.options.params.order},scope._setOrderInOptions=function(){scope.options.params.hasOwnProperty("order")?scope.options.params.order=scope._createOrderParams():scope.options.params.order=scope._createOrderParams()},scope._setChildTableActive=function(stateBool){scope.childTableActive=stateBool},scope._setChildTableParentRecord=function(recordObj){scope.childTableParentRecord=recordObj},
scope._buildChildTableOptions=function(){scope.childTableOptions={isChildTable:!0,allowChildTable:!1},scope.childTableOptions=dfObjectService.deepMergeObjects(scope.childTableOptions,angular.copy(scope.defaults))},scope._addChildTable=function(){angular.element(scope.options.childTableAttachPoint).append($compile('<df-child-table data-child-options="childTableOptions" data-parent-schema="schema" data-child-table-parent-record="childTableParentRecord"></df-child-table>')(scope))},scope._setTab=function(tabStr){scope._setElementActive(tabStr)},scope._toggleSelected=function(dataObj){scope._toggleSelectedState(dataObj)},scope._normalizeData=function(dataObj){return angular.forEach(dataObj,function(_obj){for(var _key in _obj)null==_obj[_key]&&(_obj[_key]="NULL")}),dataObj},scope._normalizeSchema=function(schemaDataObj,recordsDataArr){var normalizedSchema=[];for(var _key in schemaDataObj.field)recordsDataArr[0].hasOwnProperty(schemaDataObj.field[_key].name)&&normalizedSchema.push(schemaDataObj.field[_key]);return delete schemaDataObj.field,schemaDataObj.field=normalizedSchema,schemaDataObj},scope._getPrevious=function(){scope._previousPage()},scope._getNext=function(){scope._nextPage()},scope._editRecord=function(dataObj){scope._setCurrentEditRecord(dataObj)},scope._saveRecords=function(){scope._setInProgress(!0);var recordsToSave=scope._getRecordsWithState(scope.record,"unsaved",!0);scope._saveRecordsToServer(recordsToSave).then(function(result){angular.forEach(scope.record,function(_obj){scope._isUnsaved(_obj)&&scope._toggleUnsavedState(_obj),scope._isSelected(_obj)&&scope._toggleSelectedState(_obj),scope._hasRevertCopy(_obj)&&scope._removeRevertCopy(_obj)}),scope.$emit(scope.es.alertSuccess,{message:"Records saved."})},function(reject){throw{module:"xxDreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._revertRecords=function(){angular.forEach(scope.record,function(_obj,_index){scope._isUnsaved(_obj)&&scope._hasRevertCopy(scope.record[_index])&&(scope.record[_index]=scope._getRevertCopy(_obj))}),scope.$emit(scope.es.alertSuccess,{message:"Records reverted."})},scope._deleteRecords=function(){var recordsToDelete=scope._getRecordsWithState(scope.record,"selected");scope._deleteRecordsFromServer(recordsToDelete).then(function(result){var requestDataObj={},curPage=scope._getCurrentPage().value,curOffset=scope._getCurrentPage().offset;scope._isLastPage()&&scope.record.length===scope._getRecordsFromData(result).length&&(curOffset-=scope._getOptionFromParams("limit")),requestDataObj.params=dfObjectService.mergeObjects({offset:curOffset},scope.options.params),scope._getRecordsFromServer(requestDataObj).then(function(_result){scope.$emit(scope.es.alertSuccess,{message:"Records deleted."}),scope._prepareRecords(_result),scope._createPagesArr(scope._calcTotalPages(scope._getCountFromMeta(_result),scope._getOptionFromParams("limit"))),curPage>scope.pagesArr.length-1&&0!==curPage&&(curPage-=1,scope.pagesArr[curPage].stopPropagation=!0),scope._setCurrentPage(scope.pagesArr[curPage])},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._getRecordsWithFilter=function(){var requestDataObj={};requestDataObj.params=dfObjectService.mergeObjects({filter:scope._createFilterParams()},scope.options.params),scope._setInProgress(!0),scope._getRecordsFromServer(requestDataObj).then(function(result){scope._init(dfObjectService.mergeObjects({data:result},scope.options))},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._refreshResults=function(checkUnsavedBool){if(checkUnsavedBool=checkUnsavedBool||!0,checkUnsavedBool&&scope._checkForUnsavedRecords(scope.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return!1;var requestDataObj={};requestDataObj.params={offset:0},scope._setInProgress(!0),scope._getRecordsFromServer(requestDataObj).then(function(result){scope._prepareRecords(result),scope._calcPagination(result),scope._setCurrentPage(scope.pagesArr[0])},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._applyFilter=function(){if(scope._checkForUnsavedRecords(scope.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return!1;scope._setFilterInOptions()&&(scope.filteredRecords=!0),scope._setOrderInOptions(),scope.orderedRecords=!0;var requestDataObj={};requestDataObj.params={offset:0},scope._setInProgress(!0),scope._getRecordsFromServer(requestDataObj).then(function(result){scope._prepareRecords(result),scope._calcPagination(result),scope._setCurrentPage(scope.pagesArr[0])},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._removeFilter=function(){if(scope._checkForUnsavedRecords(scope.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return!1;scope._unsetFilterInOptions(),scope._unsetOrderInOptions(),scope._resetFilter(scope.schema),scope._resetOrder(scope.schema),scope.filteredRecords=!1,scope.orderedRecords=!1;var requestDataObj={};requestDataObj.params={offset:0},scope._setInProgress(!0),scope._getRecordsFromServer(requestDataObj).then(function(result){scope._prepareRecords(result),scope._calcPagination(result),scope._setCurrentPage(scope.pagesArr[0]),scope.filter.prop=scope.schema.field[0]},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._orderOnSelect=function(fieldObj){var orderedBy=scope.order.orderBy;orderedBy===fieldObj.name?scope.order.orderByReverse=!scope.order.orderByReverse:(scope.order.orderBy=fieldObj.name,scope.order.orderByReverse=!1)},scope._createRecord=function(){scope._setNewRecordObj()},scope._setExportValue=function(dataObj){scope._setExportValueToParent(dataObj)},scope._toggleExpandEditor=function(){scope.relatedExpand=!scope.relatedExpand},scope._editExportRecord=function(dataObj){scope.options.exportValueOn&&scope.parentRecord&&(scope.relatedExpand?scope.relatedExpand&&!scope.currentEditRecord&&scope._setCurrentEditRecord(dataObj):(scope._setCurrentEditRecord(dataObj),scope._toggleExpandEditor()))},scope._filterRecords=function(){scope.filterOn=!scope.filterOn},scope._toggleAllFields=function(){scope.tableFieldsAll=!scope.tableFieldsAll,angular.forEach(scope.tableFields,function(_obj){"[object Object]"===Object.prototype.toString.call(_obj)&&_obj.hasOwnProperty("active")&&(_obj.active=scope.tableFieldsAll)})},scope._resetAllFields=function(){scope._createFieldsObj(scope.schema.field)},scope._toggleAllRecords=function(){scope.selectedAll=!scope.selectedAll,angular.forEach(scope.record,function(_obj){scope._setSelectedState(_obj,scope.selectedAll)})},scope._showChildTable=function(parentRecordObj){return scope.childTableActive?!1:(scope._setChildTableActive(!0),scope._setChildTableParentRecord(parentRecordObj),scope._buildChildTableOptions(),scope._addChildTable(),void scope._setDisableTableBtnsState(!0))};var watchUserOptions=scope.$watchCollection("userOptions",function(newValue,oldValue){return newValue?(scope.options=dfObjectService.deepMergeObjects(newValue,scope.defaults),scope._setActiveView("table"),void dfTableCallbacksService.reset()):!1}),watchOptions=scope.$watchCollection("options",function(newValue,oldValue){if(!newValue)return!1;if(!newValue.service)return!1;if(scope.options.exportValueOn&&!scope._exportValue&&scope.parentRecord[scope.exportField.name]){var requestDataObj={};requestDataObj.params={filter:scope.exportField.ref_field+" = "+scope.parentRecord[scope.exportField.name]},scope._getRecordsFromServer(requestDataObj).then(function(result){var record=scope._getRecordsFromData(result)[0];scope._addStateProps(record),scope._exportValue=record,scope.options.params.filter&&delete scope.options.params.filter,newValue.data?(scope._init(newValue),scope._resetFilter(scope.schema),scope._resetOrder(scope.schema)):scope._getRecordsFromServer().then(function(_result){scope._init(_result),scope._resetFilter(scope.schema),scope._resetOrder(scope.schema)},function(_reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:_reject}})},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})}else newValue.data?(scope._init(newValue),scope._resetFilter(scope.schema),scope._resetOrder(scope.schema)):(scope.options.params.offset=newValue.table!==oldValue.table?0:scope.options.params.offset,scope._getRecordsFromServer().then(function(_result){scope._init(_result),scope._resetFilter(scope.schema),scope._resetOrder(scope.schema)},function(_reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:_reject}}))}),watchCurrentPage=scope.$watch("currentPage",function(newValue,oldValue){if(newValue.value==oldValue.value)return!1;if(newValue.stopPropagation)return newValue.stopPropagation=!1,!1;if(scope._checkForUnsavedRecords(scope.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return oldValue.stopPropagation=!0,scope._setCurrentPage(oldValue),!1;var requestDataObj={};requestDataObj.params={offset:newValue.offset},scope._setInProgress(!0),scope._getRecordsFromServer(requestDataObj).then(function(result){scope._prepareRecords(result)},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})}),watchCurrentEditRecord=scope.$watch("currentEditRecord",function(newValue,oldValue){newValue?(scope._hasRevertCopy(newValue)||scope._createRevertCopy(newValue),scope._filterFormSchema("edit"),scope._buildSchemaGroups(),scope._checkForGroupedSchema("Edit "+scope.schema.name.charAt(0).toUpperCase()+scope.schema.name.slice(1)),scope._setActiveView("edit")):(scope._setActiveView("table"),scope._clearGroupedSchema(),scope._clearFilteredSchema())}),watchCurrentEditRecordState=scope.$watchCollection("currentEditRecord",function(newValue,oldValue){oldValue&&null==newValue&&scope._hasRevertCopy(oldValue)&&(scope._compareObjects(oldValue,oldValue.__dfData.revert)?scope._setUnsavedState(oldValue,!0):scope._setUnsavedState(oldValue,!1))}),watchParentRecord=scope.$watchCollection("parentRecord",function(newValue,oldValue){if(!newValue)return!1;if(!newValue&&!scope._exportValue)return!1;if(null==(!scope._exportValue&&newValue[scope.exportField.name]))return!1;if(!newValue[scope.exportField.name])return scope._exportValue=null,!1;if(!scope._exportValue&&newValue[scope.exportField.name]||scope._exportValue[scope.exportField.ref_field]!==newValue[scope.exportField.name]){var requestDataObj={};return requestDataObj.params={filter:scope.exportField.ref_field+" = "+newValue[scope.exportField.name],offset:0},scope._getRecordsFromServer(requestDataObj).then(function(result){var record=scope._getRecordsFromData(result);if(!record)throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:"Revert related data record not found."};scope._addStateProps(record[0]),scope._exportValue=record[0],scope.options.params.filter&&delete scope.options.params.filter},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}}),!1}}),watchExportValue=scope.$watch("_exportValue",function(newValue,oldValue){if(!newValue&&!oldValue)return!1;if(!newValue&&oldValue){scope._setExportState(oldValue,!1);var found=!1,i=0;if(scope.record)for(;!found&&i<scope.record.length;){var record=scope.record[i];null===record[scope.exportField.name]&&(scope._setExportState(scope.record[i],!1),found=!0),i++}return scope.parentRecord[scope.exportField.name]=newValue,!1}if(!oldValue&&newValue){var found=!1,i=0;if(scope.record)for(;!found&&i<scope.record.length;){var record=scope.record[i];record[scope.exportField.name]===scope._exportValue[scope.exportField.name]&&(scope._setExportState(scope.record[i],!0),found=!0),i++}}if(oldValue&&newValue){scope._setExportState(oldValue,!1);var found=!1,i=0;if(scope.record)for(;!found&&i<scope.record.length;){var record=scope.record[i];record[scope.exportField.ref_field]===newValue[scope.exportField.ref_field]&&(scope._setExportState(scope.record[i],!0),found=!0),i++}if(found=!1,i=0,scope.record)for(;!found&&i<scope.record.length;){var record=scope.record[i];record[scope.exportField.ref_field]===oldValue[scope.exportField.ref_field]&&(scope._setExportState(scope.record[i],!1),found=!0),i++}}if(scope.parentRecord[scope.exportField.name]===newValue[scope.exportField.ref_field])return newValue&&scope._setExportState(newValue,!0),oldValue&&scope._setExportState(oldValue,!1),!1;for(var found=!1,i=0;!found&&i<scope.record.length;){var record=scope.record[i];record[scope.exportField.name]===scope._exportValue[scope.exportField.name]&&(scope._setExportState(scope.record[i],!1),found=!0),i++}scope.parentRecord[scope.exportField.name]=newValue[scope.exportField.ref_field],scope._setExportState(oldValue,!1),scope._setExportState(newValue,!0)}),watchNewRecord=scope.$watch("newRecord",function(newValue,oldValue){newValue?(scope._setActiveView("new"),scope._filterFormSchema("create"),scope._buildSchemaGroups(),scope._checkForGroupedSchema("Create "+scope.schema.name.charAt(0).toUpperCase()+scope.schema.name.slice(1))):(scope._setActiveView("table"),scope._clearGroupedSchema())}),watchChildTableParentRecord=scope.$watch("childTableParentRecord",function(newValue,oldValue){return newValue?void angular.forEach(scope.record,function(obj){obj.$$hashKey!=newValue.$$hashKey&&scope._setHideState(obj,!0)}):!1});scope.$watch("filter.prop.type ",function(newValue,oldValue){return newValue?void("boolean"===newValue?scope.filter.value="TRUE":"text"===newValue||"string"===newValue?scope.filter.value=null:(scope.filter.value=null,scope.filterType.operator="<")):!1});scope.$on(scope.es.refreshTable,function(e){scope._refreshResults(!1)}),scope.$on(scope.es.closeChildTable,function(e){scope._setChildTableParentRecord(null),angular.forEach(scope.record,function(obj){scope._setHideState(obj,!1)}),scope._setDisableTableBtnsState(!1),scope._setChildTableActive(!1)}),scope.$on("$destroy",function(e){watchUserOptions(),watchOptions(),watchCurrentPage(),watchCurrentEditRecord(),watchCurrentEditRecordState(),watchParentRecord(),watchExportValue(),watchNewRecord(),watchChildTableParentRecord()})}}}]).directive("editRecord",["DF_TABLE_ASSET_PATH","$http","dfObjectService","dfTableEventService","dfTableCallbacksService",function(DF_TABLE_ASSET_PATH,$http,dfObjectService,dfTableEventService,dfTableCallbacksService){return{restrict:"E",scope:!1,templateUrl:DF_TABLE_ASSET_PATH+"views/edit-record.html",link:function(scope,elem,attrs){scope.es=dfTableEventService,scope.closeRecord=function(){scope._closeEdit()},scope.revertRecord=function(){scope._revertRecord()},scope.deleteRecord=function(){scope._deleteRecord()},scope.saveRecord=function(){scope._saveRecord()},scope._closeEdit=function(){scope.currentEditRecord=null},scope._revertRecordData=function(){var recordCopy=scope._getRevertCopy(scope.currentEditRecord);for(var _key in recordCopy)scope.currentEditRecord.hasOwnProperty(_key)&&"__dfData"!==_key&&(scope.currentEditRecord[_key]=angular.copy(recordCopy[_key]))},scope._deleteRecordFromServer=function(recordDataObj){return $http({method:"POST",url:scope.options.url,data:{resource:[recordDataObj]},headers:{"X-HTTP-METHOD":"DELETE"}})},scope._saveRecordToServer=function(recordDataObj){return $http({method:"PATCH",url:scope.options.url,data:{resource:[recordDataObj]}})},scope._revertRecord=function(){scope._revertRecordData(),scope.$emit(scope.es.alertSuccess,{message:"Record reverted."})},scope._deleteRecord=function(){scope._setInProgress(!0),dfTableCallbacksService.run("onDelete","pre",scope.currentEditRecord),scope._deleteRecordFromServer(scope.currentEditRecord).then(function(result){dfTableCallbacksService.run("onDelete","post",result),scope.$emit(scope.es.alertSuccess,{message:"Record deleted."});var requestDataObj={},curPage=scope._getCurrentPage().value,curOffset=scope._getCurrentPage().offset;scope._isLastPage()&&"object"==typeof result&&1===scope.record.length&&(curOffset-=scope._getOptionFromParams("limit")),requestDataObj.params=dfObjectService.mergeObjects({offset:curOffset},scope.options.params),scope._getRecordsFromServer(requestDataObj).then(function(_result){scope._prepareRecords(_result),scope._createPagesArr(scope._calcTotalPages(scope._getCountFromMeta(_result),scope._getOptionFromParams("limit"))),curPage>scope.pagesArr.length-1&&0!==curPage&&(curPage-=1,scope.pagesArr[curPage].stopPropagation=!0),scope._setCurrentPage(scope.pagesArr[curPage]),scope._setCurrentEditRecord(null)},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})},scope._saveRecord=function(){scope._setInProgress(!0),dfTableCallbacksService.run("onUpdate","pre",scope.currentEditRecord),scope._saveRecordToServer(scope.currentEditRecord).then(function(result){scope._removeRevertCopy(scope.currentEditRecord),scope._setUnsavedState(scope.currentEditRecord,!1),dfTableCallbacksService.run("onUpdate","pre",result),scope.$emit(scope.es.alertSuccess,{message:"Record saved."}),scope.options.autoClose?scope._closeEdit():scope._createRevertCopy(scope.currentEditRecord)},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})}}}}]).directive("createRecord",["DF_TABLE_ASSET_PATH","$http","dfTableEventService","dfTableCallbacksService",function(DF_TABLE_ASSET_PATH,$http,dfTableEventService,dfTableCallbacksService){return{restrict:"E",scope:!1,templateUrl:DF_TABLE_ASSET_PATH+"views/create-record.html",link:function(scope,elem,attrs){scope.es=dfTableEventService,scope.closeCreateRecord=function(){scope._closeCreateRecord()},scope.saveNewRecord=function(){scope._saveNewRecord()},scope._setCreateNewRecordNull=function(){scope.newRecord=null},scope._saveNewRecordToServer=function(){return $http({method:"POST",url:scope.options.url,data:{resource:[scope.newRecord]},params:{fields:"*"}})},scope._closeCreateRecord=function(){scope._setCreateNewRecordNull()},scope._saveNewRecord=function(){var dataField,schemaField;for(dataField in scope.newRecord)if(scope.newRecord.hasOwnProperty(dataField)&&null===scope.newRecord[dataField])for(schemaField in scope.tableFields)scope.tableFields.hasOwnProperty(schemaField)&&dataField===schemaField&&scope.tableFields[schemaField].hasOwnProperty("allow_null")&&!scope.tableFields[schemaField].allow_null&&scope.tableFields[schemaField].hasOwnProperty("auto_increment")&&scope.tableFields[schemaField].auto_increment&&delete scope.newRecord[dataField];scope._setInProgress(!0),dfTableCallbacksService.run("onCreate","pre",scope.newRecord),scope._saveNewRecordToServer().then(function(result){dfTableCallbacksService.run("onCreate","post",result),0===scope.record.length?scope._refreshResults():scope.record.length<scope.options.params.limit?(scope._addStateProps(result.data.resource[0]),scope.record.push(result.data.resource[0])):scope.record.length*scope.pagesArr.length<scope.count+1&&scope.pagesArr.push(scope._createPageObj(scope.pagesArr.length)),scope.$emit(scope.es.alertSuccess,{message:"Record created."}),scope._closeCreateRecord()},function(reject){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:reject}})["finally"](function(){scope._setInProgress(!1)},function(){scope._setInProgress(!1)})}}}}]).directive("dreamfactoryBuildField",["$templateCache","$compile","dfObjectService","INSTANCE_URL",function($templateCache,$compile,dfObjectService,INSTANCE_URL){return{restrict:"A",scope:{field:"=?",service:"=?",table:"=?",extendFieldTypes:"=?",overrideFields:"=?",currentEditRecord:"=?",activeView:"=?"},link:function(scope,elem,attrs){if(scope._parseEditable=function(fieldObj){return fieldObj&&fieldObj.hasOwnProperty("validation")&&null!=fieldObj.validation?!fieldObj.validation.hasOwnProperty("api_read_only"):!0},scope.defaultFieldTypes={id:{template:"df-input-text.html",placeholder:"Id",type:"text",editable:!1},string:{template:"df-input-text.html",placeholder:"Enter String Value",type:"text",editable:!0},text:{template:"df-input-textarea.html",placeholder:"",type:"textarea",editable:!0},integer:{template:"df-input-int.html",placeholder:"Enter Integer Value",type:"number",editable:!0},"boolean":{template:"df-input-checkbox.html",placeholder:"",type:"",editable:!0},binary:{template:"df-input-binary.html",placeholder:"Enter String Value",type:"text",editable:!1},"float":{template:"df-input-number.html",placeholder:"Enter Float Value",type:"number",editable:!0},"double":{template:"df-input-number.html",placeholder:"Enter Double Value",type:"number",editable:!0},decimal:{template:"df-input-number.html",placeholder:"Enter Decimal Value",type:"number",editable:!0},datetime:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},date:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},time:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},timestamp:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},reference:{template:"df-input-reference.html",placeholder:"",type:"",editable:!1},user_id:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},user_id_on_update:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},user_id_on_create:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},timestamp_on_update:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},timestamp_on_create:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1}},scope.fieldTypes=dfObjectService.mergeObjects(scope.extendFieldTypes,scope.defaultFieldTypes),scope.overrideFields[scope.field.name]){scope.templateData={prop:scope.field.name,template:"",placeholder:scope.overrideFields[scope.field.name].display.type||"",type:scope.overrideFields[scope.field.name].display.type||"text",editable:scope.overrideFields[scope.field.name].editable,field:scope.field||"",dependent:scope.overrideFields[scope.field.name].display.dependent||!1};var type=scope.overrideFields[scope.field.name].display.type;switch(type){case"select":scope.templateData.template="df-input-select.html";break;case"checkbox":scope.templateData.template="df-input-checkbox.html";break;case"text":scope.templateData.template="df-input-text.html";break;case"textarea":scope.templateData.template="df-input-text.html";break;case"custom":scope.templateData.template=scope.overrideFields[scope.field.name].display.template;break;default:scope.templateData.template="df-input-text.html"}}else scope.templateData=scope.fieldTypes[scope.field.type],scope.templateData.editable=scope._parseEditable(scope.field);switch(scope.field.type){case"string":scope.field.hasOwnProperty("picklist")&&null!==scope.field.picklist&&scope.field.picklist.length>0&&(scope.field.hasOwnProperty("validation")&&null!==scope.field.validation&&scope.field.validation.hasOwnProperty("picklist")?scope.templateData.template="df-input-values-only-picklist.html":scope.templateData.template="df-input-values-picklist.html",scope.data=scope.field.picklist,scope.assignValue=function(itemStr){scope.currentEditRecord[scope.field.name]=itemStr});break;case"boolean":scope.templateData.template="df-input-bool-picklist.html",scope.__dfBools=[{value:!0,name:"TRUE"},{value:!1,name:"FALSE"}],scope.field.allow_null&&scope.__dfBools.unshift({value:"",name:"NULL"});break;case"reference":var systemTablePrefix="df_sys_";scope._parseSystemTableName=function(tableNameStr){var tableName=tableNameStr.substr(0,systemTablePrefix.length);return tableName===systemTablePrefix?tableNameStr.substr(systemTablePrefix.length):tableNameStr},scope._buildURL=function(serviceNameStr,tableNameStr){return INSTANCE_URL+"/api/v2/"+serviceNameStr+"/_table/"+tableNameStr},scope.relatedOptions={service:scope.service,table:scope._parseSystemTableName(scope.field.ref_table),url:scope._buildURL(scope.service,scope._parseSystemTableName(scope.field.ref_table)),params:{filter:null,limit:10,offset:0,fields:"*",include_schema:!0,include_count:!0},defaultFields:{},exportValueOn:!0},scope.relatedOptions.defaultFields[scope.field.ref_field]=!0}elem.append($compile($templateCache.get(scope.templateData.template))(scope))}}}]).directive("dfChildTable",["DF_TABLE_ASSET_PATH","INSTANCE_URL","dfObjectService","dfTableEventService",function(DF_TABLE_ASSET_PATH,INSTANCE_URL,dfObjectService,dfTableEventService){return{restrict:"E",scope:{childOptions:"=",parentSchema:"=",childTableParentRecord:"="},templateUrl:DF_TABLE_ASSET_PATH+"views/df-child-table.html",link:function(scope,elem,attrs){var systemTablePrefix="df_sys_";scope.options={},scope.childRecordsBy="",scope.service=scope.childOptions.service,scope.closeChildTable=function(){scope._closeChildTable()},scope._parseSystemTableName=function(tableNameStr){var tableName=tableNameStr.substr(0,systemTablePrefix.length);return tableName===systemTablePrefix?tableNameStr.substr(systemTablePrefix.length):tableNameStr},scope._setSystemService=function(tableNameStr){return tableNameStr.substr(0,systemTablePrefix.length)===systemTablePrefix?"system":scope.service},scope._closeChildTable=function(){scope.$emit(dfTableEventService.closeChildTable),angular.element(elem).remove()};var watchChildRecordsBy=scope.$watch("childRecordsBy",function(newValue,oldValue){if(!newValue)return!1;var options={service:scope._setSystemService(newValue.ref_table),table:newValue.ref_table,url:INSTANCE_URL+"/api/v2/"+scope._setSystemService(newValue.ref_table)+"/_table/"+scope._parseSystemTableName(newValue.ref_table),params:{filter:newValue.ref_field+" = "+scope.childTableParentRecord[newValue.field]}};scope.options=dfObjectService.deepMergeObjects(options,scope.childOptions)});scope.$on("$destroy",function(e){watchChildRecordsBy()})}}}]).service("dfTableEventService",[function(){return{alertSuccess:"alert:success",refreshTable:"refresh:table",closeChildTable:"close:childtable"}}]).service("dfTableCallbacksService",[function(){var callbacks={onCreate:{pre:[],post:[]},onDelete:{pre:[],post:[]},onUpdate:{pre:[],post:[]}};return{add:function(actionStr,processStr,method){callbacks[actionStr][processStr].push(method)},run:function(actionStr,processStr,inputRecord){return 0==callbacks[actionStr][processStr].length?!1:void angular.forEach(callbacks[actionStr][processStr],function(value,index){value.call(void 0,inputRecord)})},reset:function(){callbacks={onCreate:{pre:[],post:[]},onDelete:{pre:[],post:[]},onUpdate:{pre:[],post:[]}}}}}]),angular.module("dfServices",["ngRoute","dfUtility"]).constant("MOD_SERVICES_ROUTER_PATH","/services").constant("MOD_SERVICES_ASSET_PATH","admin_components/adf-services/").config(["$routeProvider","MOD_SERVICES_ROUTER_PATH","MOD_SERVICES_ASSET_PATH",function($routeProvider,MOD_SERVICES_ROUTER_PATH,MOD_SERVICES_ASSET_PATH){$routeProvider.when(MOD_SERVICES_ROUTER_PATH,{templateUrl:MOD_SERVICES_ASSET_PATH+"views/main.html",controller:"ServicesCtrl"})}]).run(["$templateCache",function($templateCache){}]).controller("ServicesCtrl",["$rootScope","$scope","$location","dfApiDataService","dfNotify",function($rootScope,$scope,$location,dfApiDataService,dfNotify){$scope.isAdmin=dfApiDataService.getQueryParameter("admin_app"),$scope.apiData=null,$scope.services=null,$scope.filteredServices=null,$scope.selectedGroup={name:null},$scope.selectedType={name:null},$scope.searchText={value:null},$scope.emptySearchResult={title:"There are no active services that match your search criteria!",text:$scope.isAdmin?"":"If you are not an admin user your role must allow access to the service for it to appear in this list."},$scope.saveAsFile=function(data,filename){if(data){filename||(filename="download.json"),"object"==typeof data&&(data=JSON.stringify(data,void 0,2));var blob=new Blob([data],{type:"text/json"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(blob,filename);else{var e=document.createEvent("MouseEvents"),a=document.createElement("a");a.download=filename,a.href=window.URL.createObjectURL(blob),a.dataset.downloadurl=["text/json",a.download,a.href].join(":"),e.initEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(e)}}},$scope.downloadAllServiceDef=function(){$scope.dataLoading=!0;var apis=[{path:"api_docs"}];dfApiDataService.getApiData(apis).then(function(response){$scope.saveAsFile(response[0],"all_api_docs.json")},function(error){var messageOptions={module:"Api Error",type:"error",provider:"dreamfactory",message:{data:error}};dfNotify.error(messageOptions)})["finally"](function(){$scope.dataLoading=!1})},$scope.downloadSelectedServiceDef=function(){$scope.dataLoading=!0;var apis=[{path:"api_docs/_service/"+$scope.currentEditService.name}];dfApiDataService.getApiData(apis).then(function(response){$scope.saveAsFile(response[0],$scope.currentEditService.name+"_api_docs.json")},function(error){var messageOptions={module:"Api Error",type:"error",provider:"dreamfactory",message:{data:error}};dfNotify.error(messageOptions)})["finally"](function(){$scope.dataLoading=!1})},$scope.dataLoading=!0,$scope.loadTabData=function(){var apis=[{name:"service_type",path:"api_docs/_service_type"},{name:"service",path:"api_docs/_service"}];dfApiDataService.getApiData(apis).then(function(response){var newApiData={};apis.forEach(function(value,index){newApiData[value.name]=response[index].resource?response[index].resource:response[index]}),$scope.apiData=newApiData},function(error){var messageOptions={module:"Api Error",type:"error",provider:"dreamfactory",message:{data:error}};dfNotify.error(messageOptions)})["finally"](function(){$scope.dataLoading=!1})}()}]).directive("dfManageServices",["$rootScope","MOD_SERVICES_ASSET_PATH",function($rootScope,MOD_SERVICES_ASSET_PATH){return{restrict:"E",scope:!1,templateUrl:MOD_SERVICES_ASSET_PATH+"views/df-manage-services.html",link:function(scope){var ManagedService=function(record){return{__dfUI:{selected:!1},record:record}};scope.currentEditService=null,scope.fields=[{name:"name",label:"Service Name",active:!0},{name:"label",label:"Label",active:!0},{name:"description",label:"Description",active:!0},{name:"group",label:"Group",active:!0},{name:"type_label",label:"Type",active:!0}],scope.order={orderBy:"name",orderByReverse:!1},scope.editService=function(service){scope.currentEditService=service},scope.orderOnSelect=function(fieldObj){var orderedBy=scope.order.orderBy;orderedBy===fieldObj.name?scope.order.orderByReverse=!scope.order.orderByReverse:(scope.order.orderBy=fieldObj.name,scope.order.orderByReverse=!1)},scope.$watch("apiData",function(newValue){if(newValue){var services=[];angular.forEach(scope.apiData.service,function(service){
services.push(new ManagedService(service))}),scope.services=services,scope.filteredServices=services;var group,groups={};angular.forEach(scope.apiData.service_type,function(service){group=service.group,groups.hasOwnProperty(group)||(groups[group]=[]),groups[group].push({name:service.name,label:service.label})}),scope.serviceGroups=groups,angular.forEach(scope.services,function(service){angular.forEach(scope.serviceGroups,function(value,key){angular.forEach(value,function(type){service.record.type===type.name&&(service.record.group=key,service.record.type_label=type.label)})})})}}),scope.strcmp=function(s1,s2){return s1.toLowerCase().indexOf(s2.toLowerCase())>=0},scope.applyFilter=function(){scope.services&&(scope.filteredServices=scope.services.filter(function(service){var groupMatch=null===scope.selectedGroup.name||scope.selectedGroup.name===service.record.group,typeMatch=null===scope.selectedType.name||scope.selectedType.name===service.record.type,searchMatchName=!scope.searchText.value||scope.searchText.value&&service.record.name&&scope.strcmp(service.record.name,scope.searchText.value),searchMatchLabel=!scope.searchText.value||scope.searchText.value&&service.record.label&&scope.strcmp(service.record.label,scope.searchText.value),searchMatchDesc=!scope.searchText.value||scope.searchText.value&&service.record.description&&scope.strcmp(service.record.description,scope.searchText.value);return groupMatch&&typeMatch&&(searchMatchName||searchMatchLabel||searchMatchDesc)}))},scope.$watchCollection("selectedGroup",function(newValue){newValue&&(scope.selectedType={name:null},scope.applyFilter())}),scope.$watchCollection("selectedType",function(newValue){newValue&&scope.applyFilter()}),scope.$watchCollection("searchText",function(newValue){newValue&&scope.applyFilter()})}}}]).directive("dfServiceDetails",["MOD_SERVICES_ASSET_PATH",function(MOD_SERVICES_ASSET_PATH){return{restrict:"E",scope:!1,templateUrl:MOD_SERVICES_ASSET_PATH+"views/df-service-details.html",link:function(scope){scope.closeService=function(){scope.$parent.currentEditService=null}}}}]).directive("dfApiDocsLoading",[function(){return{restrict:"E",template:"<div class='col-lg-12' ng-if='dataLoading'><span style='display: block; width: 100%; text-align: center; color: #A0A0A0; font-size: 50px; margin-top: 100px'><i class='fa fa-refresh fa-spin'></i></div>"}}]),angular.module("dfSwaggerUI",["ngRoute","dfUtility"]).constant("MOD_SWAGGER_UI_ROUTER_PATH","/swagger-ui").constant("MOD_SWAGGER_UI_ASSET_PATH","admin_components/adf-swagger-ui/").config(["$routeProvider","MOD_SWAGGER_UI_ROUTER_PATH","MOD_SWAGGER_UI_ASSET_PATH",function($routeProvider,MOD_SWAGGER_UI_ROUTER_PATH,MOD_SWAGGER_UI_ASSET_PATH){$routeProvider.when(MOD_SWAGGER_UI_ROUTER_PATH,{templateUrl:MOD_SWAGGER_UI_ASSET_PATH+"views/main.html",controller:"SwaggerUiCtrl"})}]).run(["$templateCache",function($templateCache){}]).controller("SwaggerUiCtrl",["$scope",function($scope){}]).directive("dfSwagger",["MOD_SWAGGER_UI_ASSET_PATH","$location","APP_API_KEY","$cookies",function(MOD_SWAGGER_UI_ASSET_PATH,$location,APP_API_KEY,$cookies){return{restrict:"E",scope:{serviceName:"=",isAdmin:"="},templateUrl:MOD_SWAGGER_UI_ASSET_PATH+"views/swagger.html",link:function(scope,elem,attrs){var port;scope.server=$location.protocol()+"://"+$location.host(),port=$location.port(),port&&(scope.server+=":"+port);var url=scope.server+"/api/v2/api_docs/_service/"+scope.serviceName;scope.server+="/df-api-docs-ui/bower_components/df-swagger-ui/dist/index.html",scope.server+="?api_key="+encodeURIComponent(APP_API_KEY)+"&url="+encodeURIComponent(url)+"&session_token="+encodeURIComponent($cookies.get("PHPSESSID"))}}}]),angular.module("dreamfactoryApidocsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","dfUtility","dfServices","dfSwaggerUI"]).constant("APP_VERSION","1.0.0").constant("APP_API_KEY","36fda24fe5588fa4285ac6c6c2fdfbdb6b6bc9834699774c9bf777f706d05a88").config(["$httpProvider","APP_API_KEY",function($httpProvider,APP_API_KEY){$httpProvider.defaults.headers.common["X-Dreamfactory-API-Key"]=APP_API_KEY}]),angular.module("dreamfactoryApidocsApp").controller("MainCtrl",["$scope","$location",function($scope,$location){$scope.title="DreamFactory API Docs",$location.url("/services")}]),Array.of||(Array.of=function(){return Array.prototype.slice.call(arguments)}),Array.prototype.copyWithin||(Array.prototype.copyWithin=function(target,start){if(null==this)throw new TypeError("this is null or not defined");var O=Object(this),len=O.length>>>0,relativeTarget=target>>0,to=0>relativeTarget?Math.max(len+relativeTarget,0):Math.min(relativeTarget,len),relativeStart=start>>0,from=0>relativeStart?Math.max(len+relativeStart,0):Math.min(relativeStart,len),end=arguments[2],relativeEnd=void 0===end?len:end>>0,final=0>relativeEnd?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len),count=Math.min(final-from,len-to),direction=1;for(to>from&&from+count>to&&(direction=-1,from+=count-1,to+=count-1);count>0;)from in O?O[to]=O[from]:delete O[to],from+=direction,to+=direction,count--;return O}),Array.prototype.every||(Array.prototype.every=function(callbackfn,thisArg){var T,k;if(null==this)throw new TypeError("this is null or not defined");var O=Object(this),len=O.length>>>0;if("function"!=typeof callbackfn)throw new TypeError;for(arguments.length>1&&(T=thisArg),k=0;len>k;){var kValue;if(k in O){kValue=O[k];var testResult=callbackfn.call(T,kValue,k,O);if(!testResult)return!1}k++}return!0}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(value){if(null==this)throw new TypeError("this is null or not defined");for(var O=Object(this),len=O.length>>>0,start=arguments[1],relativeStart=start>>0,k=0>relativeStart?Math.max(len+relativeStart,0):Math.min(relativeStart,len),end=arguments[2],relativeEnd=void 0===end?len:end>>0,final=0>relativeEnd?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len);final>k;)O[k]=value,k++;return O}}),Array.prototype.filter||(Array.prototype.filter=function(fun){if(void 0===this||null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var res=[],thisArg=arguments.length>=2?arguments[1]:void 0,i=0;len>i;i++)if(i in t){var val=t[i];fun.call(thisArg,val,i,t)&&res.push(val)}return res}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(predicate){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=arguments[1],k=0;len>k;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return kValue;k++}return void 0}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(predicate){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var thisArg=arguments[1],k=0;len>k;){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o))return k;k++}return-1}}),Array.prototype.forEach||(Array.prototype.forEach=function(callback){var T,k;if(null==this)throw new TypeError("this is null or not defined");var O=Object(this),len=O.length>>>0;if("function"!=typeof callback)throw new TypeError(callback+" is not a function");for(arguments.length>1&&(T=arguments[1]),k=0;len>k;){var kValue;k in O&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(searchElement,fromIndex){if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if(0===len)return!1;for(var n=0|fromIndex,k=Math.max(n>=0?n:len-Math.abs(n),0);len>k;){if(o[k]===searchElement)return!0;k++}return!1}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){var k;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),len=o.length>>>0;if(0===len)return-1;var n=0|fromIndex;if(n>=len)return-1;for(k=Math.max(n>=0?n:len-Math.abs(n),0);len>k;){if(k in o&&o[k]===searchElement)return k;k++}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(searchElement){if(void 0===this||null===this)throw new TypeError;var n,k,t=Object(this),len=t.length>>>0;if(0===len)return-1;for(n=len-1,arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),k=n>=0?Math.min(n,len-1):len-Math.abs(n);k>=0;k--)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.map||(Array.prototype.map=function(callback){var T,A,k;if(null==this)throw new TypeError("this is null or not defined");var O=Object(this),len=O.length>>>0;if("function"!=typeof callback)throw new TypeError(callback+" is not a function");for(arguments.length>1&&(T=arguments[1]),A=new Array(len),k=0;len>k;){var kValue,mappedValue;k in O&&(kValue=O[k],mappedValue=callback.call(T,kValue,k,O),A[k]=mappedValue),k++}return A}),Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(callback){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof callback)throw new TypeError(callback+" is not a function");var value,o=Object(this),len=o.length>>>0,k=0;if(2==arguments.length)value=arguments[1];else{for(;len>k&&!(k in o);)k++;if(k>=len)throw new TypeError("Reduce of empty array with no initial value");value=o[k++]}for(;len>k;)k in o&&(value=callback(value,o[k],k,o)),k++;return value}}),"function"!=typeof Array.prototype.reduceRight&&(Array.prototype.reduceRight=function(callback){if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof callback)throw new TypeError(callback+" is not a function");var value,t=Object(this),len=t.length>>>0,k=len-1;if(arguments.length>=2)value=arguments[1];else{for(;k>=0&&!(k in t);)k--;if(0>k)throw new TypeError("Reduce of empty array with no initial value");value=t[k--]}for(;k>=0;k--)k in t&&(value=callback(value,t[k],k,t));return value}),Array.prototype.some||(Array.prototype.some=function(fun){if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof fun)throw new TypeError;for(var t=Object(this),len=t.length>>>0,thisArg=arguments.length>=2?arguments[1]:void 0,i=0;len>i;i++)if(i in t&&fun.call(thisArg,t[i],i,t))return!0;return!1}),Array.prototype.toLocaleString||Object.defineProperty(Array.prototype,"toLocaleString",{value:function(locales,options){if(null==this)throw new TypeError('"this" is null or not defined');var a=Object(this),len=a.length>>>0,separator=",";if(0===len)return"";for(var firstElement=a[0],r=null==firstElement?"":firstElement.toLocaleString(locales,options),k=1;len>k;){var s=r+separator,nextElement=a[k];r=null==nextElement?"":nextElement.toLocaleString(locales,options),r=s+r,k++}return r}}),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(fNOP.prototype=this.prototype),fBound.prototype=new fNOP,fBound});